name: Build & Publish Sentiment (Serverless)


on:
schedule:
# 매일 09:30 KST ~= 00:30 UTC
- cron: '30 0 * * *'
workflow_dispatch:


jobs:
build:
runs-on: ubuntu-latest
permissions:
contents: write
steps:
- name: Checkout
uses: actions/checkout@v4
with:
fetch-depth: 0


- name: Setup Python
uses: actions/setup-python@v5
with:
python-version: '3.11'


- name: Install deps
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt


- name: Run pipeline (scrape → preprocess → score → export JSON/CSV)
run: |
python - <<'PY'
import runpy
runpy.run_module('builder.build', run_name='__main__')
PY


- name: Commit site/data artifacts
run: |
git config user.name "github-actions[bot]"
git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
git add site/data/*.json site/data/*.csv || true
git commit -m "chore: update sentiment timeseries [skip ci]" || echo "No changes"
git push


- name: Deploy to GitHub Pages
uses: peaceiris/actions-gh-pages@v3
with:
github_token: ${{ secrets.GITHUB_TOKEN }}
publish_dir: ./site
publish_branch: gh-pages
